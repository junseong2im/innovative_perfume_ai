<!DOCTYPE html>
<html>
<head>
    <title>Agentic AI Test</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Agentic AI 향수 생성 테스트</h1>

    <div>
        <h2>카드 모드 테스트</h2>
        <button onclick="testCardMode()">플로럴 로맨틱 향수 생성</button>
        <div id="cardResult"></div>
    </div>

    <div>
        <h2>채팅 모드 테스트</h2>
        <input type="text" id="chatInput" placeholder="향수 요청을 입력하세요..." style="width: 300px;">
        <button onclick="testChatMode()">채팅 테스트</button>
        <div id="chatResult"></div>
    </div>

    <script>
        async function testCardMode() {
            const resultDiv = document.getElementById('cardResult');
            resultDiv.innerHTML = '생성 중...';

            try {
                const response = await fetch('http://localhost:8000/api/v2/agentic/request', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        query: '로맨틱 분위기의 floral 계열 향수를 만들어주세요. 강도는 moderate로 해주세요. spring 계절에 어울리도록 해주세요.',
                        context: {
                            fragrance_family: 'floral',
                            mood: 'romantic',
                            intensity: 'moderate',
                            season: 'spring',
                            request_type: 'fragrance_generation'
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                resultDiv.innerHTML = `
                    <h3>성공!</h3>
                    <p><strong>메시지:</strong> ${data.message}</p>
                    <p><strong>실행 시간:</strong> ${data.execution_time}초</p>
                    <p><strong>사용된 도구:</strong> ${data.tools_used.join(', ')}</p>
                    <p><strong>요청 ID:</strong> ${data.request_id}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">오류: ${error.message}</p>`;
            }
        }

        async function testChatMode() {
            const input = document.getElementById('chatInput');
            const resultDiv = document.getElementById('chatResult');
            const message = input.value || '봄날 장미정원 같은 향수를 만들고 싶어요';

            resultDiv.innerHTML = '처리 중...';

            try {
                const response = await fetch('http://localhost:8000/api/v2/agentic/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        session_id: 'test_session',
                        context: {
                            conversation_history: '',
                            interaction_type: 'fragrance_chat',
                            message_count: 1
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                resultDiv.innerHTML = `
                    <h3>채팅 응답</h3>
                    <p><strong>응답:</strong> ${data.response}</p>
                    <p><strong>실행 시간:</strong> ${data.execution_time}초</p>
                    <p><strong>세션 ID:</strong> ${data.session_id}</p>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">오류: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>